# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger: none
pr: none

#pool:
#  vmImage: 'ubuntu-latest'

#steps:
#- script: echo Hello, world!
#  displayName: 'Run a one-line script'

#- script: |
#    echo Add other tasks to build, test, and deploy your project.
#    echo See https://aka.ms/yaml
#  displayName: 'Run a multi-line script'


schedules:
- cron: "0 23 * * Sun/2"
  displayName: Weekly Sunday disable Developer Write Access
  branches:
    exclude:
      - 
  always: true

steps:
- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      $uri = "https://api.github.com/orgs/PSW-2020-ORG9/teams/developers/repos/PSW-2020-ORG9/test"
      $header = @{Authorization="Bearer $env:TOKEN"; Accept="application/vnd.github.inertia-preview+json"}
      if($env:SPRINTPART -eq 2){
        Invoke-RestMethod -Method 'Put' -Uri $uri -Headers $header -Body '{"permission":"pull"}'
        $env:SPRINTPART = 0
      } else {
        $env:SPRINTPART = $env:SPRINTPART + 1
      }
      
  env:
    TOKEN: $(token)
    SPRINTPART: $(sprintpart)
#- task: PowerShell@2
#  inputs:
#    filePath: 'devops/script.ps1'
#  env:
#    TOKEN: $(token)